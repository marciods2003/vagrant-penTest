# Vagrant File - Infra estrutura para realização de PenTest com KaliLunux
# Servidores construidos :
# 
# - svr-pentest
# - svr-web1
# - svr-db1
# - svr-dns

machines = {
  "svr-pentest" => {"memory" => "512", "cpu" => "2", "ip" => "180", "image" => "kalilinux/rolling"},
  "svr-web1" => {"memory" => "512", "cpu" => "2", "ip" => "181", "image" => "debian/bullseye64"},
  "svr-db1" => {"memory" => "512", "cpu" => "2", "ip" => "182", "image" => "debian/bullseye64"},
  "svr-dns" => {"memory" => "512", "cpu" => "2", "ip" => "183", "image" => "generic/freebsd13"},
}


Vagrant.configure("2") do |config|
  machines.each do |name, conf|
    config.vm.define "#{name}" do |machine|
     machine.vm.box = "#{conf["image"]}"
     machine.vm.hostname = "#{name}.cda.com.br"
     machine.vm.network "public_network", ip: "192.168.2.#{conf["ip"]}"
     machine.vm.provider "virtualbox" do |vb|
      vb.name = "#{name}"
      vb.memory = conf["memory"]
      vb.cpus = conf["cpu"]
      vb.customize ["modifyvm", :id, "--groups", "/Pentest_Lab"]
    end
    
    if "#{name}" == "svr-web1"
     machine.vm.provision "shell", path: "scripts/pacotes_svr-web1.sh"
    end
    if "#{name}" == "svr-db1"
      machine.vm.provision "shell", path: "scripts/pacotes_svr-db1.sh"
    end
    if "#{name}" == "svr-dns"
      machine.vm.provision "shell", path: "scripts/pacotes_svr-dns.sh"
    end
  end
end
end
