#!/bin/bash
sleep 2
sudo apt update && sudo apt upgrade -y && sudo apt install vim rsync apache2 vsftpd php libapache2-mod-php php-cli php-mysql php-zip php-curl php-xml -y

echo "192.168.2.180 pentest.cda.com.br" >>/etc/hosts
echo "192.168.2.181 web1.cda.com.br" >>/etc/hosts
echo "192.168.2.182 db1.cda.com.br" >>/etc/hosts
echo "192.168.2.183 dns.cda.com.br" >>/etc/hosts


#
# Para Configurar VirtualHosts descomente as linhas abaixo que não for um comentario
# exemplo de comentario em uma linha #//
# onde esta " exemple.com.br voce " deve alterar para o nome so seu site
#
# ------------------ INICIO ------------------------------
#
#// criar o diretorio onde hospedara o vitrualhost
# mkdir /var/www/html/example.com
mkdir /var/www/html/web1.cda.com.br
#
#// Setar as permissoes da pasta para o usuario do serviço WEB
# chown -R www-data:www-data /var/www/html/example.com
chown -R www-data:www-data /var/www/html/web1.cda.com.br
# 
#//Criar o conteudo do arquivo de configuração do VirtualHost
#//
#cat <<EOF > /etc/apache2/sites-available/example.com.conf
#<VirtualHost *:80>
#    ServerAdmin webmaster@localhost
#    ServerName example.com
#    DocumentRoot /var/www/html/example.com
#    ErrorLog ${APACHE_LOG_DIR}/error.log
#    CustomLog ${APACHE_LOG_DIR}/access.log combined
#</VirtualHost>
#EOF
#
cat <<EOF > /etc/apache2/sites-available/web1.cda.com.br.conf
<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    ServerName web.cda.com.br
    DocumentRoot /var/www/html/web1.cda.com.br
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
EOF

#// Habilitando o site com a ferramenta - a2ensite
#a2ensite example.com.conf
a2ensite web1.cda.com.br
#
#// Desabilitando o virtualhost Padrão do Apache
#a2dissite 000-default
a2dissite 000-default
#
#--------------------- FIM --------------------------------------------
#
#// Caso queira verificar as configurações do PHP descomente as linhas abaixo
#
#--------------------- INICIO -----------------------------------------
#
#cat <<EOF > /var/www/html/example.com/phpinfo.php
# <?php phpinfo(); ?>
#EOF
#
cat <<EOF > /var/www/html/web1.cda.com.br/phpinfo.php
<?php phpinfo(); ?>
EOF
#echo "<b>teste apache *** NODE1 ***</b>" > /var/www/html/index.html
timedatectl set-timezone America/Sao_Paulo
systemctl restart apache2
systemctl enable apache2
echo "nameserver 192.168.2.183" >/etc/resolv.conf