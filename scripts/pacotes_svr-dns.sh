#!/bin/sh
#
# Instalação e configuração de um servidor DNS para o Dominio cda.com.br
# FreeBSD13
# bind9
# 
echo "192.168.2.180 pentest.cda.com.br" >>/etc/hosts
echo "192.168.2.181 web1.cda.com.br" >>/etc/hosts
echo "192.168.2.182 db1.cda.com.br" >>/etc/hosts
echo "192.168.2.183 dns.cda.com.br" >>/etc/hosts

sudo pkg install -y vim &&
sudo pkg install -y rsync &&
sudo pkg install -y bind916 &&                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
sudo sysrc named_enable=yes

# Inicio do arquivos de configuração do Bind9 
#
# - Configurado o Dominio cda.com.br (zona)
# -  
# - Diretorio dos arquivos de configuração /usr/local/etc/namedb/
# - Diretorio ./master
# - Diretorio ./slave
#
# ralizando o backup do arquivo named.conf 
cp  /usr/local/etc/namedb/named.conf  /usr/local/etc/namedb/named.conf.ORIG
cat <<EOF >> /usr/local/etc/namedb/named.conf
zone "cda.com.br" {
        allow-query {192.168.2.0/24; };
        type master;
        file "/usr/local/etc/namedb/master/cda.com.br.db";
        notify yes;
};

zone "2.168.192.in-addr.arpa" {
        type master;
        file "/usr/local/etc/named/master/db.192.168.2";
        notify yes;
};

EOF
#
# Criando o arquivo de zona para cda.com.br
#
cat <<EOF > /usr/local/etc/namedb/master/cda.com.br.db
$TTL 3h
@ SOA cda.com.br. ti.cda.com.br. 01 1d 12h 1w 3h
	; Serial, Refresh, Retry, Expire, Neg. cache TTL

; DNS Servers
                IN      NS      dns.cda.com.br.

; MX Records
                IN      MX 10   mail.cda.com.br.

                IN      A       192.168.2.181

; Machine Names
localhost       IN      A       127.0.0.1
pentest		IN	A	192.168.2.180
dns           	IN      A       192.168.2.183
web1           	IN      A       192.168.2.181
db1		IN	A	192.168.2.182
mail		IN	A	192.168.2.182

cda.com.br.	IN	TXT	"v=spf1 ip4:192.168.2.183 include:_spf.cda.com.br include:_spf.mail.cda.com.br ~all"

; Aliases

invasor		IN	CNAME	pentest

EOF
#
# Criando o arquivo da zona reversa para cda.com.br 192.168.2.0/24
#
cat <<EOF > /usr/local/etc/namedb/master/db.192.168.2
$TTL 3h
@ SOA cda.com.br. bind.cda.com.br. 01 1d 12h 1w 3h
	; Serial, Refresh, Retry, Expire, Neg. cache TTL
	
	NS	dns.cda.com.br.

180	PTR	pentest.cda.com.br.
181	PTR	web1.cda.com.br.
182	PTR	db1.cda.com.br.
183	PTR	dns.cda.com.br.
EOF

service named start
echo "nameserver 192.168.2.183" >/etc/resolv.conf